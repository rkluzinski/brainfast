# Brainfast

Brainfast is a brainf\*ck interpreter capable of running programs very quickly. The brainf\*ck source is optimized and recompiled to native x86-64 machine code using asmjit.

## Getting Started

Building, testing and benchmarking brainfast.

### Prerequisites

* A x86-64 Computer and a Linux OS.
* Any C++ Compiler Supported by CMake.
* CMake Version 3.10.2 or greater.
* Python3.x (for automating tests and benchmarks).

### Installing

Clone the brainfast github repository.

```
$ git clone https://github.com/rkluzinski/brainfast
$ cd brainfast
```

Create the build directory.

```
$ mkdir build
$ cd build
```

Run CMake.

```
$ cmake ..
```

Run the generated Makefile

```
$ make
```

The executable 'bf' should be created in the build directory. Running it with no arguments should give a usage message.

```
$ ./bf
usage: ./bf [-m MEMORY_SIZE] filename
```

## Running the tests and benchmarks.

The tests and benchmarks can be run from the top-level directory.

```
$ cd ..
```

The testing program is contained in the test/ directory. It can be run automatically using python3.
The testing program bitwidth.b is from rdebath's [brainf\*ck](https://github.com/rdebath/Brainfuck) repository. It can be run with Python3 and should display 'Hello World! 255'.

```
$ python3 test/
Running bitwidth.b: Hello World! 255
```

The benchmarks are run in similar manner as the tests. The real, user and system time will be displayed for each program and the totals. The files used for benchmarking are taken from matslina's [brainf\*ck](https://github.com/matslina/bfoptimization) repository.

Programs that output to STDOUT lots will run faster in the benchmark. This is because the output is being piped to a file and does not have to be displayed in the terminal.

Shown below is output from the Brainfast benchmark on Ubuntu 18.04 with an AMD Ryzen 7 2700X CPU.

```
$ python3 benchmarks/
program                  real     user      sys
------------------------------------------------
awib-0.4                0.017    0.017    0.000
dbfi                    0.646    0.646    0.000
factor                  0.703    0.702    0.000
hanoi                   0.056    0.052    0.004
long                    0.229    0.221    0.008
mandelbrot              0.914    0.914    0.000
total                   2.565    2.551    0.012

```

## Porting Brainfasts

In its current state, Brainfast can only be run on a x86-64 Linux computers. The code generated by the compiler is x86-64 specific, making using of the general registers r12-r14, which are not availible on a 32-bit computer. The registers used by the program and the code surrounding function calls would need to modifed inorder to port the program to a 32-bit machine. Additionally, the generated program uses the System V x86-64 ABI calling conventions. For the program to run on Windows all the calls to libc functions would need to be modified.

Feel free to fork the project and work on these issues if you would like to!

## Built With

* [AsmJit](https://github.com/asmjit/asmjit) - A remote assembler for C++
* [CMake](https://cmake.org/) - A build automation tool

## Authors

* **Ryan Kluzinski** - *Initial work* - [rkluzinski](https://github.com/rkluzinski)

## License

<This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details>

## Acknowledgments

* http://www.hevanet.com/cristofd/brainfuck/ - A great introduction to brainf\*ck.
* https://github.com/rdebath/Brainfuck - A very comprehensive test program.
* https://github.com/matslina/bfoptimization - A collection of benchmarks.
* http://calmerthanyouare.org/2015/01/07/optimizing-brainfuck.html - Various optimization strategies.
* https://eli.thegreenplace.net/ - Other work in using JIT compilation with brainf\*ck.
* http://www.nynaeve.net/?p=64 - Assembly optimization techniques.

