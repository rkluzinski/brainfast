# Brainfast

Brainfast is a brainf\*ck interpreter capable of running programs very quickly. The brainf\*ck source is optimized and recompiled to native x86-64 machine code using asmjit. Brainf\*ck programs are allocated 65536 bytes of memory by default, but this can changed using a command line argument.

## Getting Started

Building, testing and benchmarking brainfast.

### Prerequisites

* An x86-64 Computer and a Linux OS.
* Any C++ Compiler supported by CMake.
* CMake version 3.1 or greater.
* Python3.x (for tests and benchmarks).

### Installing

Clone the brainfast github repository and move to the brainfast directory.

```
$ git clone https://github.com/rkluzinski/brainfast
$ cd brainfast
```

Create the build directory and move to the build directory.

```
$ mkdir build
$ cd build
```

Run CMake with the parent folder as the argument.

```
$ cmake ..
```

Run the Makefile generated by CMake.

```
$ make
```

The executable 'bf' should be created in the build directory. Running it with no arguments should give a usage message.

```
$ ./bf
usage: ./bf [MEMORY_SIZE] filename
```

## Running the tests and benchmarks.

The tests and benchmarks can be run from the brainfast directory.

```
$ cd ..
```

The test program bitwidth.b is from rdebath's [brainf\*ck](https://github.com/rdebath/Brainfuck) repository. It can be run with Python3 and should output 'Hello World! 255'.

```
$ python3 test/
Running bitwidth.b: Hello World! 255
```

The benchmarks are run in similar manner as the tests. The files used for benchmarking are from matslina's [brainf\*ck](https://github.com/matslina/bfoptimization) repository.

Programs with lots of output to STDOUT will run faster in the benchmark because the output is being piped to a file and does not have to be displayed in the terminal.

Shown below is output from the Brainfast benchmark on Ubuntu 18.04 with an AMD Ryzen 7 2700X CPU.

```
$ python3 benchmarks/
program                  real     user      sys
------------------------------------------------
awib-0.4                0.017    0.017    0.000
dbfi                    0.646    0.646    0.000
factor                  0.703    0.702    0.000
hanoi                   0.056    0.052    0.004
long                    0.229    0.221    0.008
mandelbrot              0.914    0.914    0.000
total                   2.565    2.551    0.012

```

## Porting Brainfasts

In its current state, Brainfast only runs on x86-64 Linux computers because the code generated by the compiler is specific to that platform.

* It makes use of general registers r12-r14, not availible on x86-32.
* The generated assembly adheres to the System V x86-64 calling conventions.

For the program to run on x86-32 or Windows, these things would need to be changed.

## Built With

* [AsmJit](https://github.com/asmjit/asmjit) - A remote assembler for C++
* [CMake](https://cmake.org/) - A build automation tool

## Authors

* **Ryan Kluzinski** - *Initial work* - [rkluzinski](https://github.com/rkluzinski)

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details

## Acknowledgments

* http://www.hevanet.com/cristofd/brainfuck/ - A great introduction to brainf\*ck.
* https://github.com/rdebath/Brainfuck - A very comprehensive test program.
* https://github.com/matslina/bfoptimization - A collection of benchmarks.
* http://calmerthanyouare.org/2015/01/07/optimizing-brainfuck.html - Various optimization strategies.
* https://eli.thegreenplace.net/ - Other work in using JIT compilation with brainf\*ck.
* http://www.nynaeve.net/?p=64 - Assembly optimization techniques.

